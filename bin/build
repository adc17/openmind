#!/usr/bin/env bash

set -e

#N.B.: Always use clojure, never clj !!!

# build cljs

echo `ls $CACHE_DIR`

echo Building production cljs...

# TODO: using dev-main.js like this is a dirty and misleading hack
clojure -m cljs.main --optimizations advanced --output-to "resources/public/cljs-out/dev-main.js" -c openmind.core

echo done

# and pack uberjar

echo building uberjar...

clojure -Auberjar

echo cleanup

mv target/openmind.jar ./.openmind.jar

rm -rf ./*

mkdir target
mv ./.openmind.jar target/openmind.jar

echo ready to go
